<artifact identifier="control-mantenimiento-html" type="application/vnd.ant.code" language="html" title="control.html - Control de Mantenimiento de Planta">
{% extends 'base.html' %}
{% load static %}
{% block title %}Control de Mantenimiento de Planta{% endblock %}
{% block content %}
<div class="min-h-screen bg-gradient-to-br from-amber-50 to-orange-50 py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Encabezado -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 flex items-center gap-3">
            <span class="bg-gradient-to-r from-amber-600 to-orange-600 bg-clip-text text-transparent">
                <i class="fas fa-tools"></i> Control de Mantenimiento de Planta
            </span>
        </h1>
        <p class="mt-2 text-gray-600">Monitoreo de horas de operaci√≥n y programaci√≥n de mantenimientos</p>
    </div>

    <!-- Alerta de Estado -->
    {% if nivel_alerta == 'critico' %}
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-6 mb-8 rounded-lg shadow-lg animate-pulse">
        <div class="flex items-center">
            <i class="fas fa-exclamation-triangle text-3xl mr-4"></i>
            <div>
                <p class="font-bold text-xl">{{ mensaje_alerta }}</p>
                <p class="mt-1">Las horas acumuladas han alcanzado el l√≠mite. Realice el mantenimiento ahora.</p>
            </div>
        </div>
    </div>
    {% elif nivel_alerta == 'advertencia' %}
    <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-6 mb-8 rounded-lg shadow-lg">
        <div class="flex items-center">
            <i class="fas fa-exclamation-circle text-3xl mr-4"></i>
            <div>
                <p class="font-bold text-xl">{{ mensaje_alerta }}</p>
                <p class="mt-1">Planifique el mantenimiento en las pr√≥ximas horas de operaci√≥n.</p>
            </div>
        </div>
    </div>
    {% elif nivel_alerta == 'precaucion' %}
    <div class="bg-orange-100 border-l-4 border-orange-500 text-orange-700 p-6 mb-8 rounded-lg shadow-lg">
        <div class="flex items-center">
            <i class="fas fa-info-circle text-3xl mr-4"></i>
            <div>
                <p class="font-bold text-xl">{{ mensaje_alerta }}</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-6 mb-8 rounded-lg shadow-lg">
        <div class="flex items-center">
            <i class="fas fa-check-circle text-3xl mr-4"></i>
            <div>
                <p class="font-bold text-xl">{{ mensaje_alerta }}</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Panel Principal de Control -->
    <div class="bg-white rounded-xl shadow-2xl p-8 mb-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Medidor Circular -->
            <div class="flex flex-col items-center justify-center">
                <div class="relative w-64 h-64">
                    <svg class="transform -rotate-90 w-64 h-64">
                        <circle cx="128" cy="128" r="112" stroke="#e5e7eb" stroke-width="16" fill="none" />
                        <circle cx="128" cy="128" r="112" 
                                stroke="{% if control.porcentaje_uso >= 100 %}#dc2626{% elif control.porcentaje_uso >= 90 %}#f59e0b{% elif control.porcentaje_uso >= 75 %}#f97316{% else %}#10b981{% endif %}" 
                                stroke-width="16" 
                                fill="none"
                                stroke-dasharray="703.717"
                                stroke-dashoffset="{{ 703.717 - (703.717 * control.porcentaje_uso / 100) }}"
                                stroke-linecap="round"
                                class="transition-all duration-1000" />
                    </svg>
                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-5xl font-bold text-gray-900">{{ control.porcentaje_uso|floatformat:1 }}%</span>
                        <span class="text-sm text-gray-500 mt-2">de uso</span>
                    </div>
                </div>
                <div class="mt-6 text-center">
                    <p class="text-2xl font-bold text-gray-900">{{ control.horas_acumuladas|floatformat:2 }} / {{ control.limite_horas|floatformat:0 }} horas</p>
                    <p class="text-sm text-gray-600 mt-1">Horas acumuladas desde √∫ltimo mantenimiento</p>
                </div>
            </div>

            <!-- Informaci√≥n y Acciones -->
            <div class="space-y-6">
                <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-clock text-blue-600 mr-2"></i>
                            Horas Restantes
                        </h3>
                        <span class="text-3xl font-bold text-blue-600">{{ control.horas_restantes|floatformat:2 }}h</span>
                    </div>
                    <p class="text-sm text-gray-700">Tiempo estimado hasta el pr√≥ximo mantenimiento</p>
                </div>

                <div class="bg-gradient-to-r from-purple-50 to-purple-100 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-wrench text-purple-600 mr-2"></i>
                            Estado de la Planta
                        </h3>
                        {% if control.estado == 'operativa' %}
                        <span class="px-4 py-2 bg-green-500 text-white rounded-full font-semibold">
                            ‚úì Operativa
                        </span>
                        {% elif control.estado == 'requiere_mantenimiento' %}
                        <span class="px-4 py-2 bg-red-500 text-white rounded-full font-semibold animate-pulse">
                            ‚ö† Requiere Mantenimiento
                        </span>
                        {% else %}
                        <span class="px-4 py-2 bg-yellow-500 text-white rounded-full font-semibold">
                            üîß En Mantenimiento
                        </span>
                        {% endif %}
                    </div>
                    {% if control.ultimo_mantenimiento %}
                    <p class="text-sm text-gray-700">
                        √öltimo mantenimiento: {{ control.ultimo_mantenimiento|date:"d/m/Y H:i" }}
                    </p>
                    {% else %}
                    <p class="text-sm text-gray-700">No hay registro de mantenimiento previo</p>
                    {% endif %}
                </div>

                <div class="bg-gradient-to-r from-amber-50 to-orange-100 p-6 rounded-lg">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-history text-amber-600 mr-2"></i>
                            Total de Mantenimientos
                        </h3>
                        <span class="text-3xl font-bold text-amber-600">{{ total_mantenimientos }}</span>
                    </div>
                    <p class="text-sm text-gray-700">Mantenimientos realizados en total</p>
                </div>

                <!-- Botones de Acci√≥n -->
                <div class="flex gap-4">
                    <a href="{% url 'realizar_mantenimiento' %}" 
                       class="flex-1 px-6 py-4 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-xl hover:from-red-700 hover:to-red-800 transition-all shadow-lg hover:shadow-xl text-center font-semibold">
                        <i class="fas fa-tools mr-2"></i>
                        Realizar Mantenimiento
                    </a>
                    <a href="{% url 'historial_mantenimiento' %}" 
                       class="flex-1 px-6 py-4 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-xl hover:from-gray-700 hover:to-gray-800 transition-all shadow-lg hover:shadow-xl text-center font-semibold">
                        <i class="fas fa-list mr-2"></i>
                        Ver Historial
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Procesos Recientes que Contribuyeron -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        
        <!-- Procesados Recientes -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <i class="fas fa-cogs text-blue-600"></i>
                Procesados Recientes
            </h3>
            <div class="space-y-3">
                {% for procesado in procesados_recientes %}
                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-gray-900">{{ procesado.numero_trilla }}</p>
                            <p class="text-xs text-gray-600">{{ procesado.fecha|date:"d/m/Y" }}</p>
                        </div>
                        <span class="px-2 py-1 bg-blue-200 text-blue-800 text-xs font-semibold rounded">
                            {{ procesado.duracion_proceso }}
                        </span>
                    </div>
                </div>
                {% empty %}
                <p class="text-sm text-gray-500 text-center py-4">No hay procesados recientes</p>
                {% endfor %}
            </div>
        </div>

        <!-- Reprocesos Recientes -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <i class="fas fa-redo text-purple-600"></i>
                Reprocesos Recientes
            </h3>
            <div class="space-y-3">
                {% for reproceso in reprocesos_recientes %}
                <div class="bg-purple-50 p-3 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-gray-900">Reproceso #{{ reproceso.numero }}</p>
                            <p class="text-xs text-gray-600">{{ reproceso.fecha|date:"d/m/Y" }}</p>
                        </div>
                        <span class="px-2 py-1 bg-purple-200 text-purple-800 text-xs font-semibold rounded">
                            {{ reproceso.duracion_proceso }}
                        </span>
                    </div>
                </div>
                {% empty %}
                <p class="text-sm text-gray-500 text-center py-4">No hay reprocesos recientes</p>
                {% endfor %}
            </div>
        </div>

        <!-- Mezclas Recientes -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <i class="fas fa-blender text-green-600"></i>
                Mezclas Recientes
            </h3>
            <div class="space-y-3">
                {% for mezcla in mezclas_recientes %}
                <div class="bg-green-50 p-3 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div>
                            <p class="font-semibold text-gray-900">Mezcla #{{ mezcla.numero }}</p>
                            <p class="text-xs text-gray-600">{{ mezcla.fecha|date:"d/m/Y" }}</p>
                        </div>
                        <span class="px-2 py-1 bg-green-200 text-green-800 text-xs font-semibold rounded">
                            {{ mezcla.duracion_proceso }}
                        </span>
                    </div>
                </div>
                {% empty %}